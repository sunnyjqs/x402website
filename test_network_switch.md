# 网络切换测试说明

## 问题分析

之前余额显示为0的原因是：
1. 前端选择了"以太坊 Sepolia"网络
2. 但 MetaMask 还在 Base Sepolia 网络上
3. 查询余额时使用的 USDC 合约地址不匹配

## 修复内容

### 1. 网络匹配检查
- 在 `fetchBackendBalance` 函数中添加了网络匹配检查
- 如果 MetaMask 网络与选择的网络不匹配，会显示错误提示

### 2. 自动网络切换
- 当用户选择不同网络时，会自动尝试切换 MetaMask 网络
- 如果网络不存在，会自动添加网络配置

### 3. 改进的错误处理
- 显示当前 MetaMask 网络状态
- 提供清晰的错误信息

## 测试步骤

### 1. 测试网络切换
1. 在前端选择"以太坊 Sepolia"网络
2. 观察 MetaMask 是否自动切换到对应网络
3. 检查控制台日志确认网络切换状态

### 2. 测试余额查询
1. 确保 MetaMask 在正确的网络上
2. 点击"刷新余额"按钮
3. 检查控制台日志确认网络匹配状态
4. 验证余额是否正确显示

### 3. 测试网络不匹配情况
1. 手动在 MetaMask 中切换到错误的网络
2. 点击"刷新余额"按钮
3. 应该看到网络不匹配的错误提示

## 预期行为

### ✅ 正常情况
- 选择网络后，MetaMask 自动切换
- 余额查询成功，显示正确数值
- 控制台显示网络匹配确认信息

### ⚠️ 网络不匹配
- 显示错误提示："MetaMask 网络不匹配！"
- 提示用户切换到正确的网络
- 余额查询被阻止

### 🔄 网络切换过程
- 控制台显示网络切换日志
- 如果网络不存在，自动添加网络配置
- 切换完成后自动刷新余额

## 调试信息

在浏览器控制台中，你应该能看到：
```
🔄 网络切换到 以太坊 Sepolia 测试网
🔄 尝试切换到网络: 以太坊 Sepolia 测试网 (0xaa36a7)
✅ 成功切换到 以太坊 Sepolia 测试网
🔍 获取余额 - 地址: 0x..., 网络: 以太坊 Sepolia 测试网, USDC合约: 0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238
🔗 确认网络匹配 - MetaMask: 0xaa36a7, 期望: 0xaa36a7
💰 ETH 余额: 0x... (wei) = 0.123456 ETH
💰 USDC 余额: 0x... (wei) = 100.000000 USDC
```

## 故障排除

如果仍然有问题：

1. **检查 MetaMask 网络**：确保显示的是正确的网络名称
2. **查看控制台错误**：检查是否有网络切换失败的错误
3. **手动切换网络**：在 MetaMask 中手动选择正确的网络
4. **刷新页面**：重新加载页面后重试

## 网络配置验证

确保以下配置正确：
- 以太坊 Sepolia: Chain ID 11155111 (0xaa36a7)
- USDC 合约: 0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238
- RPC URL: https://sepolia.infura.io/v3/9511773c563f4094b07478fb1706488b
